{{- range $name, $knight := .Values.knights }}
{{- if $knight.enabled }}
---
apiVersion: v1
kind: Service
metadata:
  name: knight-{{ $name }}
  namespace: {{ $.Values.namespace }}
  labels:
    {{- include "roundtable.knightLabels" (dict "ctx" $ "name" $name "knight" $knight) | nindent 4 }}
spec:
  selector:
    {{- include "roundtable.knightSelectorLabels" (dict "name" $name) | nindent 4 }}
  ports:
    - name: openclaw
      port: {{ $knight.openclaw.port | default 18789 }}
      targetPort: openclaw
    - name: bridge-health
      port: 8080
      targetPort: bridge-health
{{- end }}
{{- end }}
