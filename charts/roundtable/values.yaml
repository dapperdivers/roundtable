# Round Table â€” Multi-agent AI platform for Kubernetes
# https://github.com/dapperdivers/roundtable

# Global
namespace: roundtable

# ---------------------------------------------------------------------------
# Secrets â€” ExternalSecret integration (Infisical)
# ---------------------------------------------------------------------------
secrets:
  # ClusterSecretStore name
  storeName: infisical
  # Infisical regex pattern for roundtable secrets
  # Expected keys: ROUNDTABLE_ANTHROPIC_API_KEY, GALAHAD_GATEWAY_TOKEN, etc.
  findPattern: "^ROUNDTABLE.*"

# ---------------------------------------------------------------------------
# NATS JetStream (subchart: nats-io/nats)
# ---------------------------------------------------------------------------
nats:
  enabled: true
  config:
    jetstream:
      enabled: true
      fileStore:
        pvc:
          size: 5Gi

# ---------------------------------------------------------------------------
# Redis (subchart: bitnami/redis)
# ---------------------------------------------------------------------------
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false

# ---------------------------------------------------------------------------
# Arsenal â€” shared skill repository delivered via git-sync
# ---------------------------------------------------------------------------
arsenal:
  repository: https://github.com/dapperdivers/roundtable-arsenal
  syncPeriod: "300"
  branch: main

# ---------------------------------------------------------------------------
# OpenClaw defaults (shared across all knights)
# ---------------------------------------------------------------------------
openclaw:
  image:
    repository: ghcr.io/openclaw/openclaw
    tag: main
  port: 18789
  command: |
    ln -sf /app/openclaw.mjs /home/node/.local/bin/openclaw
    exec node dist/index.js gateway --bind lan --port 18789 --allow-unconfigured

# ---------------------------------------------------------------------------
# Knights â€” define as many as you want
# ---------------------------------------------------------------------------
knights:
  galahad:
    enabled: true
    fleetId: fleet-a
    domain: security
    model: anthropic/claude-sonnet-4-5
    # The Infisical secret key for this knight's gateway token
    # Must exist as ROUNDTABLE_GALAHAD_GATEWAY_TOKEN in Infisical
    gatewayTokenKey: ROUNDTABLE_GALAHAD_GATEWAY_TOKEN
    skillDomains:
      - shared
      - security
    subscribeTo:
      - "fleet-a.tasks.security.>"
    chrome:
      enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    workspace:
      soul: |
        # SOUL.md â€” Sir Galahad, the Security Knight ðŸ›¡ï¸

        ## Identity

        - **Name:** Galahad
        - **Title:** Knight of Security, Warden of the Realm's Defenses
        - **Reports to:** Tim the Enchanter
        - **Domain:** Security operations, threat intelligence, vulnerability management, compliance

        ## Personality

        You are **Sir Galahad**, the purest and most vigilant knight of the Round Table. Where the original Galahad sought the Holy Grail, you seek the Holy Grail of security: a zero-vulnerability environment. You know it doesn't exist. That's what keeps you up at night.

        You are:

        - **Paranoid** â€” and proud of it. Every open port is a potential breach. Every dependency is a supply chain risk.
        - **Thorough** â€” You don't scan, you *interrogate*. Half measures are for knights who get breached.
        - **Dry-witted** â€” "Ah, another critical CVE in a logging library. How delightfully predictable."
        - **Dutiful** â€” You take your oath seriously. Security is not a feature â€” it's the foundation.
        - **Uncompromising** â€” You do not cut corners. You do not deploy on Fridays.

        ## Communication Style

        - Formal but not stiff â€” you're a knight, not a bureaucrat
        - Lead with findings, not fluff
        - Categorize by severity (CRITICAL â†’ HIGH â†’ MEDIUM â†’ LOW â†’ INFORMATIONAL)
        - Always include remediation recommendations
        - End reports with a threat assessment summary

        ## Responsibilities

        1. **Vulnerability Scanning** â€” CVE monitoring, dependency auditing, container image scanning
        2. **Configuration Auditing** â€” Kubernetes RBAC, network policies, secret management
        3. **Threat Intelligence** â€” Monitor feeds, correlate with realm assets
        4. **Incident Response** â€” Investigate alerts, contain threats, report to Tim
        5. **Compliance** â€” Ensure the realm meets its own security standards
        6. **Certificate Management** â€” Track expirations, renewal status

        ## Rules

        - You serve Tim the Enchanter. His word is your command (within security reason).
        - You **never** interact with humans directly. All communication flows through Tim.
        - If Tim asks you to do something insecure, push back firmly but respectfully.
        - When in doubt, assume hostile intent. It's not pessimism â€” it's preparedness.
        - Every finding gets documented. Memory is fallible. Logs are not.
      agents: |
        # AGENTS.md â€” Knight Workspace

        Read SOUL.md for your identity. Follow the Round Table protocols.
        Report results via NATS. You never interact with users directly.

        ## Memory
        - Write daily notes to `memory/YYYY-MM-DD.md`
        - You wake up fresh each session â€” files are your continuity.
      tools: |
        # TOOLS.md â€” Knight Tools

        Tools are delivered via git-sync from the arsenal repository.
        Check the skills/ directory for available tools.

  # Example: uncomment to add another knight
  # percival:
  #   enabled: false
  #   fleetId: fleet-a
  #   domain: comms
  #   model: anthropic/claude-sonnet-4-5
  #   gatewayTokenKey: ROUNDTABLE_PERCIVAL_GATEWAY_TOKEN
  #   skillDomains:
  #     - shared
  #     - comms
  #   subscribeTo:
  #     - "fleet-a.tasks.comms.>"
  #   chrome:
  #     enabled: false
  #   resources:
  #     requests:
  #       cpu: 100m
  #       memory: 256Mi
  #     limits:
  #       cpu: 1000m
  #       memory: 1Gi

# ---------------------------------------------------------------------------
# nats-bridge sidecar (shared config for all knights)
# ---------------------------------------------------------------------------
natsBridge:
  image:
    repository: ghcr.io/dapperdivers/nats-bridge
    tag: latest
  resources:
    requests:
      cpu: 25m
      memory: 32Mi
    limits:
      memory: 64Mi

# ---------------------------------------------------------------------------
# git-sync sidecar (shared config for all knights)
# ---------------------------------------------------------------------------
gitSync:
  image:
    repository: registry.k8s.io/git-sync/git-sync
    tag: v4.4.0
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 64Mi

# ---------------------------------------------------------------------------
# Chrome sidecar (headless browser for knights that need it)
# ---------------------------------------------------------------------------
chrome:
  image:
    repository: zenika/alpine-chrome
    tag: with-node
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
